---
title: "Estimation"
author: "Jonas Richter"
date: "2023-01-10"
output: html_document
---
# Data

Get realistic quotes for win/draw/loss
```{r}
# source = https://www.kaggle.com/datasets/austro/beat-the-bookie-worldwide-football-dataset/code?resource=download
#quotes = read.csv(file = "../Application/closing_odds.csv")
#win = median(quotes$avg_odds_home_win) - 1.5
#draw = median(quotes$avg_odds_draw) - 1.5
#loss = median(quotes$avg_odds_away_win) - 1.5

win = 0.6
draw = 2.2
loss = 1.1
```
Get prediction/truth
```{r}
## get predictions/truth
results_k = read.csv(file = "../Output/K_fold_testing/results_k.csv")

# subset 100 rows
#results_k = results_k[sample(10200,100),]
```

# RF

## Bet on everything
```{r}
a = ifelse(results_k$results_RF == "win" & results_k$Outcome == "win", win,
       ifelse(results_k$results_RF == "draw" & results_k$Outcome == "draw", draw,
              ifelse(results_k$results_RF == "loss" & results_k$Outcome == "loss", loss, -1)))
sum(a)
table(a)
```
## Bet on wins and losses only
```{r}
b = ifelse(results_k$results_RF == "win" & results_k$Outcome == "win", win,
           ifelse(results_k$results_RF == "win" & results_k$Outcome != "win", -1,
                  ifelse(results_k$results_RF == "loss" & results_k$Outcome != "loss", -1,
                     ifelse(results_k$results_RF == "loss" & results_k$Outcome == "loss", loss, 0))))
sum(b)
table(b)
```
## Bet on wins only
```{r}
c = ifelse(results_k$results_RF == "win" & results_k$Outcome == "win", win,
           ifelse(results_k$results_RF == "win" & results_k$Outcome != "win", -1, 0))
sum(c)
table(c)
```
## Bet on loss only
```{r}
d = ifelse(results_k$results_RF == "loss" & results_k$Outcome == "loss", loss,
           ifelse(results_k$results_RF == "loss" & results_k$Outcome != "loss", -1, 0))
sum(d)
table(d)
```
# naivebayes

## Bet on everything
```{r}
a2 = ifelse(results_k$results_naivebayes == "win" & results_k$Outcome == "win", win,
       ifelse(results_k$results_naivebayes == "draw" & results_k$Outcome == "draw", draw,
              ifelse(results_k$results_naivebayes == "loss" & results_k$Outcome == "loss", loss, -1)))
sum(a2)
table(a2)
```
## Bet on wins and losses only
```{r}
b2 = ifelse(results_k$results_naivebayes == "win" & results_k$Outcome == "win", win,
           ifelse(results_k$results_naivebayes == "win" & results_k$Outcome != "win", -1,
                  ifelse(results_k$results_naivebayes == "loss" & results_k$Outcome != "loss", -1,
                     ifelse(results_k$results_naivebayes == "loss" & results_k$Outcome == "loss", loss, 0))))
sum(b2)
table(b2)
```
## Bet on wins only
```{r}
c2 = ifelse(results_k$results_naivebayes == "win" & results_k$Outcome == "win", win,
           ifelse(results_k$results_naivebayes == "win" & results_k$Outcome != "win", -1, 0))
sum(c2)
table(c2)
```
## Bet on loss only
```{r}
d2 = ifelse(results_k$results_naivebayes == "loss" & results_k$Outcome == "loss", loss,
           ifelse(results_k$results_naivebayes == "loss" & results_k$Outcome != "loss", -1, 0))
sum(d2)
table(d2)
```


# ENSEMBLE
## Bet on everything
```{r}
e = ifelse(results_k$results_RF == "win" & results_k$results_naivebayes == "win" & results_k$Outcome == "win", win,
           ifelse(results_k$results_RF == "draw" & results_k$results_naivebayes == "draw" & results_k$Outcome == "draw", draw,
                  ifelse(results_k$results_RF == "loss" & results_k$results_naivebayes == "loss" & results_k$Outcome == "loss", loss, -1)))

sum(e)
table(e)
```
## Bet on wins and losses only
```{r}
f = ifelse(results_k$results_RF == "win" & results_k$Outcome == "win" & results_k$results_naivebayes == "win", win,
           ifelse(results_k$results_RF == "win" & results_k$results_naivebayes == "win" & results_k$Outcome != "win", -1,
                     ifelse(results_k$results_RF == "loss" & results_k$results_naivebayes == "loss" & results_k$Outcome != "loss", -1,
                         ifelse(results_k$results_RF == "loss" & results_k$results_naivebayes == "loss" & results_k$Outcome == "loss", loss, 0))))

sum(f)
table(f)
```
## Bet on wins only
```{r}
g = ifelse(results_k$results_RF == "win" & results_k$results_naivebayes == "win" & results_k$Outcome == "win", win,
                  ifelse(results_k$results_RF == "win" & results_k$results_naivebayes == "win" & results_k$Outcome != "win", -1, 0))

sum(g)
table(g)
```
## Bet on loss only
```{r}
h = ifelse(results_k$results_RF == "loss" & results_k$results_naivebayes == "loss" & results_k$Outcome == "loss", loss,
                  ifelse(results_k$results_RF == "loss" & results_k$results_naivebayes == "loss" & results_k$Outcome != "loss", -1, 0))

sum(h)
table(h)
```
# Strengths of individual classifiers
```{r}
# accuracy wins naivebayes
s = ifelse(results_k$results_naivebayes == "win" & results_k$Outcome == "win", TRUE,
               ifelse(results_k$results_naivebayes == "win" & results_k$Outcome != "win", FALSE, 8))
s_clean = s[!s %in% 8]
mean(s_clean)

# accuracy wins RF
s = ifelse(results_k$results_RF == "win" & results_k$Outcome == "win", TRUE,
               ifelse(results_k$results_RF == "win" & results_k$Outcome != "win", FALSE, 8))
s_clean = s[!s %in% 8]
mean(s_clean)

# accuracy losss naivebayes
s = ifelse(results_k$results_naivebayes == "loss" & results_k$Outcome == "loss", TRUE,
               ifelse(results_k$results_naivebayes == "loss" & results_k$Outcome != "loss", FALSE, 8))
s_clean = s[!s %in% 8]
mean(s_clean)

# accuracy losss RF
s = ifelse(results_k$results_RF == "loss" & results_k$Outcome == "loss", TRUE,
               ifelse(results_k$results_RF == "loss" & results_k$Outcome != "loss", FALSE, 8))
s_clean = s[!s %in% 8]
mean(s_clean)

# accuracy draw naivebayes
s = ifelse(results_k$results_naivebayes == "draw" & results_k$Outcome == "draw", TRUE,
               ifelse(results_k$results_naivebayes == "draw" & results_k$Outcome != "draw", FALSE, 8))
s_clean = s[!s %in% 8]
mean(s_clean)

# accuracy draw RF
s = ifelse(results_k$results_RF == "draw" & results_k$Outcome == "draw", TRUE,
               ifelse(results_k$results_RF == "draw" & results_k$Outcome != "draw", FALSE, 8))
s_clean = s[!s %in% 8]
mean(s_clean)

# accuracy wins ensembl
s = ifelse(results_k$results_naivebayes == "win" & results_k$results_RF == "win" & results_k$Outcome == "win", TRUE,
               ifelse(results_k$results_naivebayes == "win" & results_k$results_RF == "win" & results_k$Outcome != "win", FALSE, 8))
s_clean = s[!s %in% 8]
mean(s_clean)

# accuracy loss ensembl
s = ifelse(results_k$results_naivebayes == "loss" & results_k$results_RF == "loss" & results_k$Outcome == "loss", TRUE,
               ifelse(results_k$results_naivebayes == "loss" & results_k$results_RF == "loss" & results_k$Outcome != "loss", FALSE, 8))
s_clean = s[!s %in% 8]
mean(s_clean)
```
*Conclusion*: apparently, RF has highest accuracy for loss and naivebayes for win
# ENSEMBLE single choice
```{r}
i = ifelse(results_k$results_naivebayes == "win" & results_k$results_RF != "loss" & results_k$Outcome == "win", win,
             ifelse(results_k$results_naivebayes != "win" & results_k$results_RF == "loss" & results_k$Outcome == "loss", loss,
                    ifelse(results_k$results_naivebayes == "win" & results_k$results_RF != "loss" & results_k$Outcome == "loss", -1,
                           ifelse(results_k$results_naivebayes == "win" & results_k$results_RF != "loss" & results_k$Outcome == "draw", -1,
                                  ifelse(results_k$results_naivebayes != "win" & results_k$results_RF == "loss" & results_k$Outcome == "win", -1,
                                         ifelse(results_k$results_naivebayes != "win" & results_k$results_RF == "loss" & results_k$Outcome == "draw", -1,
                                                0))))))
sum(i)
table(i)
```
```{r}
df = data.frame(everything_RF = sum(a),
                wins_losses_RF = sum(b),
                wins_RF = sum(c),
                losses_RF = sum(d),
                everything_naivebayes = sum(a2),
                wins_losses_naivebayes = sum(b2),
                wins_naivebayes = sum(c2),
                losses_naivebayes = sum(d2),
                everything_ensembl = sum(e),
                wins_losses_ensembl = sum(f),
                wins_ensembl = sum(g),
                losses_ensembl = sum(h),
                wins_losses_selected = sum(i))
df_c = tidyr::pivot_longer(data = df, cols = 1:ncol(df))

library(ggplot2)

ggplot(df_c, aes(x = reorder(name, -value), y = value))+
  geom_bar(stat="identity")+
  theme(axis.text.x = element_text(angle = 90))

ggsave(filename = paste0("./profit", Sys.time(), ".jpg"))
```


